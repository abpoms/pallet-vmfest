<html lang="en">
  <head>
    <title>Pallet-vmfest 0.3.0-alpha.6 API documentation</title>
    <link href="css/default.css" type="text/css" rel="stylesheet" />
    <link href="css/codox-md.css" type="text/css" rel="stylesheet" />
    <link href="http://palletops.com" rel="project" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/page_effects.js"></script>
  </head>
  <body>
    <header>
    <div data-scrollspy="scrollspy" class="topbar">
      <div class="topbar-inner">
        <div class="container">
          <a href="/" class="brand">Pallet</a>
          <ul class="nav">
            <li class=""><a href="/doc">Documentation</a></li>
            <li class=""><a href="/news">News</a></li>
            <li class=""><a href="/blog">Blog</a></li>
            <li class=""><a href="https://github.com/pallet/pallet">Code</a></li>
            <li class=""><a href="/services">Services</a></li>
            <li class=""><a href="/support">Support</a></li>
            <li class=""><a href="/contact">Contact</a></li>
          </ul>
          <form action="http://www.google.com/search" method="get" class="pull-right">
            <input placeholder="Search" value="" maxlength="255" name="q" type="text" />
            <input value="palletops.com" type="hidden" name="sitesearch" />
          </form>
        </div>
      </div>
    </div>

      <div id="header">
        <h1><a href="http://palletops.com"><span class="project-title">Pallet-vmfest 0.3.0-alpha.6 API documentation</span></a></h1>
      </div>
    </header>
    <navigation>
      <div id="namespaces" class="sidebar">
        <h3>Namespaces</h3>
        <ul class="ns-links">
          <li class="ns-list"><a class="ns-link ns-name" href="cfg.current.html">cfg.current</a><a class="ns-link ns-name" href="pallet.compute.vmfest.html">pallet.compute.vmfest</a><a class="ns-link ns-name" href="pallet.compute.vmfest.properties.html">pallet.compute.vmfest.properties</a><a class="ns-link ns-name" href="pallet.task.add-vmfest-image.html">pallet.task.add-vmfest-image</a><a class="ns-link ns-name" href="pallet.task.vmfest-script.html">pallet.task.vmfest-script</a></li>
        </ul>
      </div>
    </navigation>
    <article>
      <div id="content" class="namespace-index">
        <h2 class="project-title">Pallet-vmfest 0.3.0-alpha.6 API documentation</h2>
        <div class="doc"><p>A pallet provider for using vmfest.</p>
</div>
        <div class="project-namespaces">
          <div class="namespace">
            <h3 href="cfg.current.html" class="ns-link"><a class="ns-link ns-name" href="cfg.current.html">cfg.current</a></h3>
            <div class="doc">
</div>
            <div class="index ns-var-links">
              <p>Public variables and functions:</p>
              <ul>
                
              </ul>
            </div>
          </div><div class="namespace">
            <h3 href="pallet.compute.vmfest.html" class="ns-link"><a class="ns-link ns-name" href="pallet.compute.vmfest.html">pallet.compute.vmfest</a></h3>
            <div class="doc"><p>The VMFest provider allows Pallet to use VirtualBox via VMFest.</p>

<h2>Example Configuration</h2>

<p>An example service configuration in <code>~/.pallet/config.clj</code></p>

<pre><code>:vb {:provider "vmfest"
     :default-local-interface "vboxnet0"
     :default-bridged-interface "en1: Wi-Fi 2 (AirPort)"
     :default-network-type :local
     :vbox-comm :xpcom ;; or :ws for web services
     :hardware-models
     {:test
      {:memory-size 768
       :cpu-count 1}
      :test-2
      {:memory-size 512
       :network-type :bridged}
     :images {:centos-5-3 {:description "CentOS 5.3 32bit"
                           :uuid "4697bdf7-7acf-4a20-8c28-e20b6bb58e25"
                           :os-family :centos
                           :os-version "5.3"
                           :os-type-id "RedHat"}
              :ubuntu-10-04 {:description "Ubuntu 10.04 32bit"
                             :uuid "8a31e3aa-0d46-41a5-936d-25130dcb16b7"
                             :os-family :ubuntu
                             :os-version "10.04"
                             :os-type-id "Ubuntu"
                             :username
                             :password}}
     :model-path "/Volumes/My Book/vms/disks"
     :node-path "/Volumes/My Book/vms/nodes"}
</code></pre>

<p>The uuid's can be found using <code>vboxmanage</code></p>

<pre><code>vboxmanage list hdds
</code></pre>

<p> or it can be the path to time image file itself (.vdi).</p>

<p>The images are disks that are immutable.  The virtualbox extensions need
to be installed on the image.</p>

<h2>Communication with the VirtualBox subsystem</h2>

<p>There are two ways to connect to VirtualBox: XPCOM and Web Services.</p>

<p>The Web Services method is the most universal way to access the
VBox subsystem, as it works either for local or remote hosts, and
also is generally better supported, but it has the drawback that it
is slower and it requires the <code>vboxwebsrv</code> process to be running.</p>

<p>XPCOM is faster and easier to set up (no configuration), but only
works when the VMs are in the same host as Pallet.</p>

<p><code>pallet-vmfest</code> can only use one communication method with
VirtualBox, and once this method is set, it cannot be changed
without restarting the JVM.</p>

<p>In the provider configuration, <code>:vbox-comm</code> defaults to <code>:xpcom</code>,
and it can be switched to <code>:ws</code> to use Web Services.</p>

<h2>VMs' hardware configuration</h2>

<p>The hardware model to be run by pallet can be defined in the node template or
built from the template and a default model. The model will determine by the
first match in the following options</p>

<ul>
<li>The template has a <code>:hardware-model</code> entry with a vmfest hardware map.
The VMs created will follow this model
  e.g. <code>{... :hardware-model {:memory-size 1400 ...}}</code></li>
<li>The template has a <code>:hardware-id</code> entry. The value for this entry should
correspond to an entry in the hardware-models map (or one of the entries
that pallet offers by default.
  e.g. <code>{... :hardware-id :small ...}</code></li>
<li>The template has no hardware entry. Pallet will use the first model
in the hardware-models map to build an image that matches the rest of
the relevant entries in the map.</li>
</ul>

<p>By default, pallet offers the following specializations of this base model:</p>

<pre><code>{:memory-size 512
 :cpu-count 1
 :storage [{:name "IDE Controller"
            :bus :ide
            :devices [nil nil nil nil]}]
 :boot-mount-point ["IDE Controller" 0]})
</code></pre>

<p>The defined machines correspond to the above with some overrides:</p>

<pre><code>{:micro {:memory 512 :cpu-count 1}
 :small {:memory-size 1024 :cpu-count 1}
 :medium {:memory-size 2048 :cpu-count 2}
 :large {:memory-size (* 4 1024) :cpu-count 4}
</code></pre>

<p>You can define your own hardware models that will be added to the default
ones, or in the case that they're named the same, they will replace the
default ones.  Custom models will also extend the base model above.</p>

<h2>Networking</h2>

<p>Pallet offers two networking models: local and bridged.</p>

<p>In Local mode pallet creates two network interfaces in the VM, one for an
internal network (e.g. vboxnet0), and the other one for a NAT network. This
option doesn't require VM's to obtain an external IP address, but requires
the image booted to bring up at least eth0 and eth1, so this method won't
work on all images.</p>

<p>In Bridged mode pallet creates one interface in the VM that is bridged on a
phisical network interface. For pallet to work, this physical interface must
have an IP address that must be hooked in an existing network. This mode
works with all images.</p>

<p>The networking configuration for each VM created is determined by (in order):</p>

<ul>
<li>the template contains a <code>:hardware-model</code> map with a <code>:network-type</code>
entry</li>
<li>the template contains a <code>:network-type</code> entry</li>
<li>the service configuration contains a <code>:default-network-type</code> entry</li>
<li><code>:local</code></li>
</ul>

<p>Each networking type must attach to a network interface, be it local or
bridged.  The decision about which network interface to attach is done in the
following way (in order):</p>

<ul>
<li>For bridged networking:
<ul><li>A <code>:default-bridged-interface</code> entry exists in the service definition</li>
<li>Pallet will try to find a suitable interface for the machine.</li>
<li>if all fails, VMs will fail to start</li></ul></li>
<li>For local networking:
<ul><li>A <code>:default-local-interface</code> entry exists in the service definition</li>
<li>vboxnet0 (created by default by VirtualBox)</li></ul></li>
</ul>

<h2>Links</h2>

<ul>
<li><a href="https://github.com/tbatchelli/vmfest">VMFest</a></li>
<li><a href="https://virtualbox.org/">VirtualBox</a></li>
<li><a href="http://palletops.com/">Pallet</a></li>
</ul>
</div>
            <div class="index ns-var-links">
              <p>Public variables and functions:</p>
              <ul>
                <li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.compute.vmfest.html#var-add-image">add-image</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.compute.vmfest.html#var-add-vbox-to-classpath">add-vbox-to-classpath</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.compute.vmfest.html#var-extract-jar">extract-jar</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.compute.vmfest.html#var-find-images">find-images</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.compute.vmfest.html#var-has-image%3F">has-image?</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.compute.vmfest.html#var-install-image">install-image</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.compute.vmfest.html#var-publish-image">publish-image</a></li>
              </ul>
            </div>
          </div><div class="namespace">
            <h3 href="pallet.compute.vmfest.properties.html" class="ns-link"><a class="ns-link ns-name" href="pallet.compute.vmfest.properties.html">pallet.compute.vmfest.properties</a></h3>
            <div class="doc"><p>Namespace to guess the vbox.home system property</p>
</div>
            <div class="index ns-var-links">
              <p>Public variables and functions:</p>
              <ul>
                
              </ul>
            </div>
          </div><div class="namespace">
            <h3 href="pallet.task.add-vmfest-image.html" class="ns-link"><a class="ns-link ns-name" href="pallet.task.add-vmfest-image.html">pallet.task.add-vmfest-image</a></h3>
            <div class="doc"><p>A task for adding vmfest images</p>
</div>
            <div class="index ns-var-links">
              <p>Public variables and functions:</p>
              <ul>
                <li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.task.add-vmfest-image.html#var-add-vmfest-image">add-vmfest-image</a></li>
              </ul>
            </div>
          </div><div class="namespace">
            <h3 href="pallet.task.vmfest-script.html" class="ns-link"><a class="ns-link ns-name" href="pallet.task.vmfest-script.html">pallet.task.vmfest-script</a></h3>
            <div class="doc"><p>A task for running vmfest scripts</p>
</div>
            <div class="index ns-var-links">
              <p>Public variables and functions:</p>
              <ul>
                <li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.task.vmfest-script.html#var-vmfest-script">vmfest-script</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </article>
  </body>

</html>